# Дополнительная информация по смарт-контрактам TGDAO

### Содежрание
* [Функциональные возможности TGDAOToken](#tgdaotoken)
* [Функциональные возможности CommonSale](#commonsale)
* [Функциональные возможности VestingWallet](#vestingwallet)

## <a name="tgdaotoken"></a>Функциональные возможности TGDAOToken
1. TGDAO - `burnable` контракт. Это значит, что любой пользователь может "сжечь" часть своих токенов, тем самым уменьшив `total supply`.
2. TGDAO - `pausable` контракт. В любой момент `owner` может приостановить работу контракта с помощью метода `pause`.  
В состоянии паузы невозможно осуществлять действия по переводу и сжиганию токенов. Для того чтобы снять контракт с паузы, `owner`у следует вызвать метод `unpause`.
3. У контракта TGDAO есть функционал, который позволяет `owner`у выводить с адреса контракта токены, и `BNB` отправленные на него по ошибке.  
Для этого следует воспользоваться методами `retrieveTokens` и `retrieveETH` соответственно.  
Метод `retrieveTokens` принимает два параметра: адрес, на который нужно отправить токены и адрес смарт-контракта токена.  
Методу `retrieveETH` нужен только один параметр: адрес, на который нужно отправить `BNB`.

## <a name="commonsale"></a>Функциональные возможности CommonSale
1. Как и контракт токена, CommonSale является `pausable` контрактом, поэтому в случае непредвиденных ситуаций операции покупки и вывода токенов можно приостановить.
2. Как и в случае с контрактом токена, у контракта CommonSale предусмотрены методы для вывода токенов и `BNB`.
Вывод `BNB`, скорее всего, не потребуется (контракт принимает средства только во время действия распродажи).
С помощью метода `retreiveTokens` администратор может выводить с контракта другие токены, отправленные по ошибке.
### Этапы распродажи
Распродажа проводится в несколько этапов.
Этап описывается с помощью объекта:
```
struct Stage {
    uint256 start;
    uint256 end;
    uint256 bonus;
    uint256 minInvestmentLimit;
    uint256 invested;
    uint256 tokensSold;
    uint256 hardcapInTokens;
    uint8 vestingSchedule;
}
```
* `start` - дата начала этапа в формате `unixtime`
* `end` - дата окончания этапа в формате `unixtime`
* `bonus` - бонус в процентах от суммы покупки, который начисляется пользователю за приобретение токенов на данном этапе
* `minInvestmentLimit` - минимальная сумма покупки в `wei`
* `invested` - сумма привлеченных инвестиций на данном этапе в `wei`
* `tokensSold` - количество проданных токенов на данном этапе
* `hardcapInTokens` - хардкап для данного этапа
* `vestingSchedule` - `id` графика вестинга. В случае, если вестинг для данного этапа не предусмотрен, `0`.

Каждый раз, когда пользователь отправляет `BNB` на адрес смарт-контракта, производится поиск подходящего этапа.
В случае, если подходящий этап не найден, пользователю возвращается ошибка.  
Контракт имеет несколько методов для изменения параметров этапов. Мы рекомендуем использовать метод `updateStage`.  
> Обратите внимание! Нумерация этапов ведется с `0`. Таким образом, 1-й этап имеет `id` равный `0`.

С помощью этого метода `owner` может задавать основные параметры любого этапа.  
Общие правила взаимодействия со смарт-контрактом можно узнать в [инструкции для администратора](manager.md)  
> Мы рекомендуем использовать вкладку `config` в таблице `TGDAO`, которая позволяет приобразовывать человекопонятные значения во внутреннее представление смарт-контракта.  
> На всякий случай перед тем как вносить изменения, проконсультируйтесь с разработчиком :)

### Правила вестинга
К любому из этапов распродажи можно применить правила вестинга.
На момент написания этого документа вестинг применяется только к первому этапу распродажи.
Вестинг подразумевает, что токены, приобретенные во время соответствующего этапа распродажи, не переводятся на адрес покупателя, а остаются на адресе контракта распродажи.  
Для того чтобы вывести токены, пользователю нужно будет вызвать метод `withdraw` контракта распродажи.  
* В случае, если условия вестинга соблюдены и к выводу доступны токены, контракт переведет расчетную сумму на адрес пользователя.  
* В случае, если на балансе пользователя нет токенов, доступных к выводу, смарт-контракт вернет ошибку.

Пользователь может сэкономить свои средства и не выполнять транзакцию, т.к. Metamask заранее распознает транзакции, которые возвращают ошибки, и выводит уведомление перед отправкой.  
Параметры вестинга описываются с помощью объекта `VestingSchedule`
```
struct VestingSchedule {
    uint256 start;
    uint256 duration;
    uint256 interval;
}
```
* `start` - дата, с которой начинается отсчет, в формате `unixtime`
* `duration` - суммарная продолжительность рассроченной выплаты в секундах
* `interval` - длительность временного промежутка между выплатами в секундах

Для установки параметров вестинга `owner`у следует использовать метод `setVestingSchedule`.
Данный метод помимо вышеперечисленных принимает также параметр `id`.
На момент написания данного документа в смарт-контракте зарегистрирован один `VestingSchedule` со следующими параметрами:
```
id: 1
start: 1644192000
duration: 25920000
interval: 2592000
```
> Внимание! `id` равный `0` зарезервирован. Его использование в методе `setVestingSchedule` может привести к некорректной работе смарт-контракта.  
> Пожалуйста используйте для `id` значения `> 0`

## <a name="vestingwallet"></a>Функциональные возможности VestingWallet
Контракт `VestingWallet` работает с двумя группами пользователей:
1. `owner`. Данный пользователь может производить первоначальную конфигурацию контракта и вызывать служебные методы для вывода токенов и средств, отправленных на него по ошибке.
2. `beneficiary`. Данный пользователь является конечным пользователем данного контракта и имеет право выводить с него токены в соответствии с графиком вестинга.

Конфигурации подлежат следующие параметры смарт-контракта:
* `token` - адрес токена
* `beneficiary` - адрес конечного пользователя
* `start` - дата начала отсчета в формате `unixtime`
* `duration` - суммарная продолжительность рассроченной выплаты в секундах
* `interval` - длительность временного промежутка между выплатами в секундах

На момент написания этого документа у всех 6 контрактов, залитых в сеть, эти параметры уже предустановлены.
Для каждого из этих параметров в контракте имеется отдельная функция-сеттер.
Вызывать их может только `owner`.  
После установки даты (или других параметров при необходимости), `owner` должен вызвать метод `lock` смарт-контракта.
После этого параметры уже не смогут быть изменены, а `beneficiary` получит права на вызвов метода `withdraw`.
> Настоятельно рекомендуем проконсультироваться с разработчиком по вопросу конфигурации смарт-контракта.  
> Мы поможем сконвертировать дату в формат, с которым работает смарт-контракт, или проверим ваше значение.
